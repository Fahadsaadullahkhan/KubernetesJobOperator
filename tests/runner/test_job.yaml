apiVersion: batch/v1
kind: Job
metadata:
  name: test-job
  finalizers:
    - foregroundDeletion
spec:
  template:
    metadata:
      labels:
        app: test-job-service
    spec:
      restartPolicy: Never
      containers:
        - name: job-executor
          image: ubuntu
          command:
            - bash
            - -c
            - |
              #/usr/bin/env bash
              echo "Starting $PASS_ARG"
              cur_count=0
              while true; do
                  cur_count=$((cur_count + 1))
                  if [ "$cur_count" -ge "$TIC_COUNT" ]; then
                      break
                  fi
                  date
                  sleep 1
              done

              exit 22

              echo "Complete"
          env:
            - name: TIC_COUNT
              value: '0'
  backoffLimit: 0
---
apiVersion: v1
kind: Service
metadata:
  name: test-job-service
spec:
  selector:
    app: test-job-pod
  ports:
    - port: 8080
      targetPort: 8080
